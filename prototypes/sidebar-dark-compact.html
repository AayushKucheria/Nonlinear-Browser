<!DOCTYPE html>
<!--
  PROTOTYPE 3: Dark Compact (Power User)

  Design direction: Dense, dark-themed, keyboard-friendly.
  Feels like a dev tool or VS Code side panel. Maximum info per pixel.

  Key choices:
  - Dark palette (#1e1e2e bg, #cdd6f4 text — Catppuccin-inspired)
  - Tree connector lines (CSS borders) to show hierarchy clearly
  - Very compact rows (24px) — more tabs visible at once
  - Status indicators: colored dot = active, dim = background, strikethrough = closed
  - Keyboard shortcut hints visible in footer
  - Tab count + depth level shown in muted text
  - No favicons — title + domain suffix for context
-->
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Sidebar — Dark Compact</title>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg: #1e1e2e;
      --bg2: #181825;
      --bg3: #313244;
      --surface: #45475a;
      --text: #cdd6f4;
      --text-muted: #6c7086;
      --text-dim: #45475a;
      --accent: #89b4fa;
      --accent2: #cba6f7;
      --green: #a6e3a1;
      --red: #f38ba8;
      --yellow: #f9e2af;
      --border: #313244;
    }

    body {
      font-family: 'JetBrains Mono', 'Fira Code', 'Cascadia Code', 'Consolas', monospace;
      font-size: 12px;
      background: var(--bg);
      color: var(--text);
      width: 300px;
      min-height: 600px;
      display: flex;
      flex-direction: column;
      line-height: 1;
    }

    /* ── Header ── */
    .header {
      background: var(--bg2);
      border-bottom: 1px solid var(--border);
      padding: 8px 10px;
      display: flex;
      align-items: center;
      gap: 8px;
      flex-shrink: 0;
    }
    .header-title {
      font-size: 10px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--accent2);
      flex: 1;
    }
    .header-stats {
      font-size: 10px;
      color: var(--text-muted);
    }
    .icon-btn {
      width: 22px; height: 22px;
      border: none; background: none; cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      border-radius: 4px;
      color: var(--text-muted);
      font-size: 13px;
    }
    .icon-btn:hover { background: var(--bg3); color: var(--text); }

    /* search */
    .search-row {
      padding: 6px 8px;
      background: var(--bg2);
      border-bottom: 1px solid var(--border);
      flex-shrink: 0;
    }
    .search {
      width: 100%;
      padding: 5px 8px;
      background: var(--bg3);
      border: 1px solid var(--border);
      border-radius: 4px;
      color: var(--text);
      font-family: inherit;
      font-size: 11px;
      outline: none;
    }
    .search::placeholder { color: var(--text-muted); }
    .search:focus { border-color: var(--accent); }

    /* ── Scroll ── */
    .tree {
      flex: 1;
      overflow-y: auto;
      padding: 4px 0;
    }
    .tree::-webkit-scrollbar { width: 4px; }
    .tree::-webkit-scrollbar-track { background: transparent; }
    .tree::-webkit-scrollbar-thumb { background: var(--bg3); border-radius: 2px; }

    /* ── Window label ── */
    .win-label {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px 3px;
      font-size: 9.5px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--text-dim);
      cursor: pointer;
      user-select: none;
    }
    .win-label:hover { color: var(--text-muted); }
    .win-label::before { content: '▾'; font-size: 8px; transition: transform 0.1s; }
    .win-label.collapsed::before { transform: rotate(-90deg); }
    .win-label::after {
      content: '';
      flex: 1;
      height: 1px;
      background: var(--border);
    }
    .win-count {
      font-size: 9px;
      color: var(--text-dim);
      background: var(--bg3);
      padding: 1px 5px;
      border-radius: 3px;
      order: 10;
    }

    /* ── Tab row ── */
    .tab-row {
      display: flex;
      align-items: stretch;
      min-height: 24px;
      cursor: pointer;
      position: relative;
    }
    .tab-row:hover > .tab-inner { background: var(--bg3); }
    .tab-row.is-active > .tab-inner { background: rgba(137, 180, 250, 0.08); }
    .tab-row.is-active .tab-title { color: var(--accent); font-weight: 600; }
    .tab-row.is-closed .tab-title { color: var(--text-dim); text-decoration: line-through; }
    .tab-row.is-closed .status-dot { background: var(--text-dim); opacity: 0.4; }

    /* tree lines */
    .tree-lines {
      display: flex;
      flex-shrink: 0;
      align-items: stretch;
    }
    .tree-line-seg {
      width: 16px;
      flex-shrink: 0;
      position: relative;
    }
    .tree-line-seg.vert::before {
      content: '';
      position: absolute;
      left: 8px; top: 0; bottom: 0;
      width: 1px;
      background: var(--border);
    }
    .tree-line-seg.branch::before {
      content: '';
      position: absolute;
      left: 8px; top: 0; bottom: 50%;
      width: 1px;
      background: var(--border);
    }
    .tree-line-seg.branch::after {
      content: '';
      position: absolute;
      left: 8px; top: 50%;
      width: 8px; height: 1px;
      background: var(--border);
    }

    .tab-inner {
      flex: 1;
      display: flex;
      align-items: center;
      gap: 5px;
      padding: 0 8px 0 2px;
      border-radius: 3px;
      min-width: 0;
    }

    /* toggle */
    .toggle {
      width: 12px; height: 24px;
      display: flex; align-items: center; justify-content: center;
      flex-shrink: 0;
      font-size: 8px;
      color: var(--text-muted);
      cursor: default;
    }
    .toggle.clickable { cursor: pointer; }
    .toggle.clickable:hover { color: var(--text); }

    /* status dot */
    .status-dot {
      width: 5px; height: 5px;
      border-radius: 50%;
      flex-shrink: 0;
    }
    .is-active .status-dot { background: var(--accent); }
    .tab-row:not(.is-active):not(.is-closed) .status-dot { background: var(--text-dim); }

    /* title */
    .tab-title {
      flex: 1;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      font-size: 11.5px;
      color: var(--text);
      line-height: 24px;
    }

    /* domain */
    .tab-domain {
      font-size: 9.5px;
      color: var(--text-dim);
      flex-shrink: 0;
      max-width: 60px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    /* close */
    .tab-close {
      opacity: 0;
      width: 16px; height: 16px;
      display: flex; align-items: center; justify-content: center;
      border-radius: 3px;
      font-size: 10px;
      color: var(--text-muted);
      flex-shrink: 0;
    }
    .tab-row:hover .tab-close { opacity: 1; }
    .tab-close:hover { background: rgba(243, 139, 168, 0.2); color: var(--red); }

    /* ── Footer ── */
    .footer {
      border-top: 1px solid var(--border);
      background: var(--bg2);
      padding: 6px 10px;
      display: flex;
      align-items: center;
      gap: 8px;
      flex-shrink: 0;
    }
    .footer-hint {
      font-size: 9.5px;
      color: var(--text-dim);
    }
    .kbd {
      display: inline-block;
      background: var(--bg3);
      border: 1px solid var(--surface);
      border-radius: 3px;
      padding: 0 3px;
      font-size: 9px;
      color: var(--text-muted);
    }
    .footer-btn {
      font-family: inherit;
      font-size: 10px;
      color: var(--text-muted);
      cursor: pointer;
      padding: 3px 8px;
      border-radius: 4px;
      border: 1px solid var(--border);
      background: var(--bg3);
    }
    .footer-btn:hover { border-color: var(--accent); color: var(--accent); }
  </style>
</head>
<body>

<div class="header">
  <span class="header-title">⬡ tabs</span>
  <span class="header-stats" id="stats"></span>
  <button class="icon-btn" title="Sort">↕</button>
  <button class="icon-btn" title="Collapse all">⊟</button>
</div>

<div class="search-row">
  <input class="search" id="search" placeholder="/ filter tabs" oninput="render()">
</div>

<div class="tree" id="tree"></div>

<div class="footer">
  <span class="footer-hint"><kbd class="kbd">↑↓</kbd> navigate</span>
  <span class="footer-hint"><kbd class="kbd">⏎</kbd> focus</span>
  <span class="footer-hint"><kbd class="kbd">⌫</kbd> close</span>
  <span style="flex:1"></span>
  <button class="footer-btn" onclick="alert('Tree saved!')">save</button>
</div>

<script>
function domain(title) {
  const map = {
    'Google': 'google.com', 'Gmail': 'mail.google', 'Google Docs': 'docs.google',
    'Google Drive': 'drive.google', 'Google Slides': 'slides.google',
    'GitHub': 'github.com', 'YouTube': 'youtube.com',
    'Hacker News': 'ycomb.', 'Linear': 'linear.app',
    'anthropics': 'github.com', 'Issues': 'github.com', 'PR': 'github.com',
    'Ask HN': 'ycomb.', 'Show HN': 'ycomb.',
  };
  for (const [k, v] of Object.entries(map)) if (title.includes(k)) return v;
  return '';
}

const windows = [
  {
    id: 'w1', label: 'win:1', collapsed: false,
    tabs: [
      { id: 1, title: 'Google', active: true, closed: false, children: [
        { id: 2, title: 'Gmail — Inbox (3)', active: false, closed: false, children: [] },
        { id: 3, title: 'Google Docs — Q4 Planning', active: false, closed: false, children: [
          { id: 4, title: 'Google Drive — Shared', active: false, closed: false, children: [] },
          { id: 5, title: 'Google Slides — Team Deck', active: false, closed: true, children: [] },
        ]},
      ]},
      { id: 6, title: 'GitHub', active: false, closed: false, children: [
        { id: 7, title: 'anthropics/claude-code', active: false, closed: false, children: [
          { id: 8, title: 'Issues · anthropics/claude-code', active: false, closed: false, children: [] },
          { id: 9, title: 'PR #412 — Fix context window', active: false, closed: true, children: [] },
        ]},
      ]},
      { id: 10, title: 'YouTube', active: false, closed: false, children: [] },
    ]
  },
  {
    id: 'w2', label: 'win:2', collapsed: false,
    tabs: [
      { id: 11, title: 'Hacker News', active: false, closed: false, children: [
        { id: 12, title: 'Ask HN: Learn Rust in 2025?', active: false, closed: false, children: [] },
        { id: 13, title: 'Show HN: Tab manager ext.', active: false, closed: false, children: [] },
      ]},
      { id: 14, title: 'Linear — My Issues', active: false, closed: false, children: [] },
    ]
  }
];

const collapsedTabs = new Set();

function allFlat(tabs, arr = []) {
  for (const t of tabs) { arr.push(t); allFlat(t.children, arr); }
  return arr;
}

function countOpen(tabs) {
  let n = 0;
  for (const t of tabs) { if (!t.closed) n++; n += countOpen(t.children); }
  return n;
}

function setActive(id) {
  for (const w of windows) allFlat(w.tabs).forEach(t => t.active = false);
  for (const w of windows) {
    const t = allFlat(w.tabs).find(t => t.id === id);
    if (t) { t.active = true; break; }
  }
  render();
}

function toggleClose(id) {
  for (const w of windows) {
    const t = allFlat(w.tabs).find(t => t.id === id);
    if (t) { t.closed = !t.closed; break; }
  }
  render();
}

function matchSearch(tab, q) {
  if (!q) return true;
  if (tab.title.toLowerCase().includes(q)) return true;
  for (const c of tab.children) if (matchSearch(c, q)) return true;
  return false;
}

function renderNode(tab, depth, container, ancestors, isLast, q) {
  // Build tree lines
  const row = document.createElement('div');
  row.className = 'tab-row' + (tab.active ? ' is-active' : '') + (tab.closed ? ' is-closed' : '');

  // Tree line segments
  if (depth > 0) {
    const lines = document.createElement('div');
    lines.className = 'tree-lines';
    // ancestor lines
    for (let i = 0; i < depth - 1; i++) {
      const seg = document.createElement('span');
      seg.className = 'tree-line-seg ' + (ancestors[i] ? 'vert' : '');
      lines.appendChild(seg);
    }
    // branch line for current
    const seg = document.createElement('span');
    seg.className = 'tree-line-seg branch';
    lines.appendChild(seg);
    row.appendChild(lines);
  }

  const inner = document.createElement('div');
  inner.className = 'tab-inner';

  // toggle
  const tog = document.createElement('span');
  tog.className = 'toggle' + (tab.children.length ? ' clickable' : '');
  if (tab.children.length) {
    tog.textContent = collapsedTabs.has(tab.id) ? '▶' : '▾';
    tog.onclick = (e) => {
      e.stopPropagation();
      if (collapsedTabs.has(tab.id)) collapsedTabs.delete(tab.id);
      else collapsedTabs.add(tab.id);
      render();
    };
  }
  inner.appendChild(tog);

  // dot
  const dot = document.createElement('span');
  dot.className = 'status-dot';
  inner.appendChild(dot);

  // title
  const title = document.createElement('span');
  title.className = 'tab-title';
  title.textContent = tab.title;
  inner.appendChild(title);

  // domain
  const dom = domain(tab.title);
  if (dom) {
    const d = document.createElement('span');
    d.className = 'tab-domain';
    d.textContent = dom;
    inner.appendChild(d);
  }

  // close
  const cls = document.createElement('span');
  cls.className = 'tab-close';
  cls.textContent = '⊗';
  cls.title = tab.closed ? 'Reopen' : 'Close';
  cls.onclick = (e) => { e.stopPropagation(); toggleClose(tab.id); };
  inner.appendChild(cls);

  row.appendChild(inner);

  if (!tab.closed) row.onclick = () => setActive(tab.id);
  container.appendChild(row);

  if (!collapsedTabs.has(tab.id)) {
    const visibleChildren = tab.children.filter(c => matchSearch(c, q));
    visibleChildren.forEach((child, i) => {
      const childIsLast = i === visibleChildren.length - 1;
      renderNode(child, depth + 1, container,
        [...ancestors, !isLast],
        childIsLast, q);
    });
  }
}

function render() {
  const tree = document.getElementById('tree');
  tree.innerHTML = '';
  const q = document.getElementById('search').value.toLowerCase().trim();

  let totalOpen = 0;
  let totalAll = 0;
  for (const w of windows) {
    const all = allFlat(w.tabs);
    totalAll += all.length;
    totalOpen += countOpen(w.tabs);
  }
  document.getElementById('stats').textContent = `${totalOpen}/${totalAll}`;

  for (const w of windows) {
    if (windows.length > 1) {
      const label = document.createElement('div');
      label.className = 'win-label' + (w.collapsed ? ' collapsed' : '');
      label.textContent = w.label;
      const badge = document.createElement('span');
      badge.className = 'win-count';
      badge.textContent = countOpen(w.tabs);
      label.appendChild(badge);
      label.onclick = () => { w.collapsed = !w.collapsed; render(); };
      tree.appendChild(label);
    }

    if (!w.collapsed) {
      const visibleTabs = w.tabs.filter(t => matchSearch(t, q));
      visibleTabs.forEach((tab, i) => {
        renderNode(tab, 0, tree, [], i === visibleTabs.length - 1, q);
      });
    }
  }
}

render();
</script>
</body>
</html>
